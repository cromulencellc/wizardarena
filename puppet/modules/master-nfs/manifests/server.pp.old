class master-nfs::server { 
	$exports = hiera("exports")
	define list_exports {
    		$export = $name
    		file { $export:
			ensure => directory,
			mode   => '0775',
			owner  => 'root',
			#      group  => 'root'
    		}
	}
	list_exports { $exports:; } -> File['/etc/exports']
	package { 'rpcbind':
		ensure => latest,
 	}
	package { 'nfs-utils':
		ensure => latest,
	}
	file { '/etc/sysconfig/nfs':
		ensure  => present,
		owner   => "root",
		group   => "root",
		mode    => "0644",
		source  => "puppet:///modules/master-nfs/sysconfig-nfs",
		require => Package['nfs-utils']
	}
	file { '/etc/exports':
		content => template("nfs/exports.erb"),
	} ~> Service['nfs']

	service { "rpcbind":
		ensure => running,
		enable => true,
	}
	service { "nfs":
		ensure    => running,
		enable    => true,
		subscribe => File['/etc/sysconfig/nfs'],
		require   => Service['rpcbind']
	} 
}
